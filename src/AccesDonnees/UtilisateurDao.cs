using Dapper;
using System;
using System.Collections.Generic;
using System.Data;
using System.Text;
using System.Linq;

namespace tp2_BriceCamus.AccesDonnees
{
    class UtilisateurDao : IUtilisateurDao
    {
        private readonly IDbConnection _connexion;

        public UtilisateurDao(IDbConnection connexion)
        {
            _connexion = connexion;
        }

        public int Creer(Utilisateur utilisateur)
        {
            string requete = @"INSERT INTO dbo.Utilisateur(noDEP
                                                        ,noTYPEUTIL
                                                        ,nomUTIL
                                                        ,prenomUTIL
                                                        ,courrielUTIL
                                                        ,motpasseUTIL
                                                        ,telUTIL
                                                        ,nePlusAfficher
                                                        ,dateSuppression)
                                                OUTPUT INSERTED.[noUTIL]
                                                VALUES (@noDEP       
                                                       ,@noTYPEUTIL           
                                                       ,@nomUTIL 
                                                       ,@prenomUTIL       
                                                       ,@courrielUTIL        
                                                       ,@motpasseUTIL         
                                                       ,@telUTIL            
                                                       ,@nePlusAfficher          
                                                       ,@dateSuppression);";

            return _connexion.QuerySingle<int>(requete, utilisateur);
        }
        public Utilisateur Lire(int id)
        {
            string requete = @"SELECT * FROM dbo.Utilisateur WHERE noUTIL = @noUtil;";
            return _connexion.QuerySingleOrDefault<Utilisateur>(requete, new { noUtil = id });
        }

        public int MettreAJour(Utilisateur utilisateur)
        {
            string requete = @"UPDATE dbo.Utilisateur
                                  SET noDEP = @noDEP
                                     ,noTYPEUTIL = @noTYPEUTIL
                                     ,nomUTIL = @nomUTIL
                                     ,prenomUTIL = @prenomUTIL
                                     ,courrielUTIL = @courrielUTIL
                                     ,motpasseUTIL = @motpasseUTIL
                                     ,telUTIL = @telUTIL
                                     ,nePlusAfficher = @nePlusAfficher
                                     ,dateSuppression = @dateSuppression
                                WHERE noUTIL = @noUTIL;";

            return _connexion.Execute(requete, utilisateur);
        }
        public int Supprimer(int id)
        {
            string requete = "DELETE FROM dbo.Utilisateur WHERE noUTIL = @noUTIL;";
            return _connexion.Execute(requete, new { noUTIL = id });
        }
    }
}
