using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Transactions;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using tp2_BriceCamus.AccesDonnees;

namespace tp2_BriceCamus
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        private readonly IUtilisateurDao _utilisateurDao;
        Utilisateur utilisateur;

        public MainWindow(IUtilisateurDao utilisateurDao)
        {
            InitializeComponent();

            _utilisateurDao = utilisateurDao;
        }

        private void TextBox_TextChanged(object sender, TextChangedEventArgs e)
        {

        }

        private void BtnChercher_Click(object sender, RoutedEventArgs e)
        {
            utilisateur = _utilisateurDao.Lire(Convert.ToInt32(TextBoxInputNoUtil.Text));
            RemplirTextBox();
        }

        private void BtnCreerModifier_Click(object sender, RoutedEventArgs e)
        {
            bool aucunUtilisateurSelectionne = TextBoxInputNoUtil.Text == "";
            int id;
            int nbStagiaireModifie;

            if (aucunUtilisateurSelectionne)
            {

                using (var scope = new TransactionScope(TransactionScopeOption.Required))
                {
                    CreationUtilisateur();

                    id = _utilisateurDao.Creer(utilisateur);
                    scope.Complete();
                    
                    MessageBox.Show("Numéro de stagiaire: " + id);
                    ViderInterface();
                }
            }
            else if(!aucunUtilisateurSelectionne)
            {
                using (var scope = new TransactionScope(TransactionScopeOption.Required))
                {
                    utilisateur = _utilisateurDao.Lire(Convert.ToInt32(TextBoxInputNoUtil.Text));

                    ModificationUtilisateur();

                    nbStagiaireModifie = _utilisateurDao.MettreAJour(utilisateur);
                    scope.Complete();
                    
                    MessageBox.Show("Nombre de stagiaires modifié: " + nbStagiaireModifie);
                    ViderInterface();
                }
            }
        }

        private void BtnSupprimer_Click(object sender, RoutedEventArgs e)
        {
            bool aucunUtilisateurSelectionne = TextBoxInputNoUtil.Text == "";
            int nbStagiaireSupprimer;


            if (aucunUtilisateurSelectionne)
            {
                MessageBox.Show("Aucun utilisateur selectionner\nVeuillez entrer un numéro de stagiaire");
            }
            else
            {
                using (var scope = new TransactionScope(TransactionScopeOption.Required))
                {
                    nbStagiaireSupprimer = _utilisateurDao.Supprimer(Convert.ToInt32(TextBoxInputNoUtil.Text));
                    scope.Complete();

                    MessageBox.Show("Nombre de stagiaires supprimé: " + nbStagiaireSupprimer);
                    ViderInterface();
                }
            }

        }

        private void BtnViderInterface_Click(object sender, RoutedEventArgs e)
        {
            ViderInterface();
        }

        private void RemplirTextBox()
        {
            TextBoxNoUtil.Text = utilisateur.noUTIL.ToString();
            TextBoxNoDep.Text = utilisateur.noDEP.ToString();
            TextBoxNoTypeUtil.Text = utilisateur.noTYPEUTIL.ToString();
            TextBoxNomUtil.Text = utilisateur.nomUTIL;
            TextBoxPrenomUtil.Text = utilisateur.prenomUTIL;
            TextBoxCourrielUtil.Text = utilisateur.courrielUTIL;
            TextBoxMotPasseUtil.Text = utilisateur.motpasseUTIL;
            TextBoxNePlusAfficher.Text = utilisateur.nePlusAfficher.ToString();
            TextBoxDateSuppression.Text = utilisateur.DateSuppression.ToString();
            TextBoxSupprimerPar.Text = utilisateur.supprimerPar;
        }

        private void ViderInterface()
        {
            TextBoxInputNoUtil.Clear();
            TextBoxNoUtil.Clear();
            TextBoxNoDep.Clear();
            TextBoxNoTypeUtil.Clear();
            TextBoxNomUtil.Clear();
            TextBoxPrenomUtil.Clear();
            TextBoxCourrielUtil.Clear();
            TextBoxMotPasseUtil.Clear();
            TextBoxNePlusAfficher.Clear();
            TextBoxDateSuppression.Clear();
            TextBoxSupprimerPar.Clear();
        }

        private void CreationUtilisateur()
        {
            utilisateur = new Utilisateur
            {
                noDEP = Convert.ToInt32(TextBoxNoDep.Text),
                noTYPEUTIL = Convert.ToInt32(TextBoxNoTypeUtil.Text),
                nomUTIL = TextBoxNomUtil.Text,
                prenomUTIL = TextBoxPrenomUtil.Text,
                courrielUTIL = TextBoxCourrielUtil.Text,
                motpasseUTIL = TextBoxMotPasseUtil.Text,
                nePlusAfficher = Convert.ToInt32(TextBoxNePlusAfficher.Text),
                DateSuppression = Convert.ToDateTime(TextBoxDateSuppression.Text),
                supprimerPar = TextBoxSupprimerPar.Text
            };
        }

        private void ModificationUtilisateur()
        {
            utilisateur = new Utilisateur
            {
                noUTIL = Convert.ToInt32(TextBoxInputNoUtil.Text),
                noDEP = Convert.ToInt32(TextBoxNoDep.Text),
                noTYPEUTIL = Convert.ToInt32(TextBoxNoTypeUtil.Text),
                nomUTIL = TextBoxNomUtil.Text,
                prenomUTIL = TextBoxPrenomUtil.Text,
                courrielUTIL = TextBoxCourrielUtil.Text,
                motpasseUTIL = TextBoxMotPasseUtil.Text,
                nePlusAfficher = Convert.ToInt32(TextBoxNePlusAfficher.Text),
                DateSuppression = Convert.ToDateTime(TextBoxDateSuppression.Text),
                supprimerPar = TextBoxSupprimerPar.Text
            };
        }

    }
}
